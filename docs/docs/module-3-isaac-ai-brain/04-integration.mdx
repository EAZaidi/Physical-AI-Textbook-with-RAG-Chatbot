---
slug: 04-integration
---

# Chapter 4: Integrating Perception â†’ Mapping â†’ Navigation

## Learning Objectives

- Understand the complete autonomous navigation pipeline (Isaac Sim â†’ Isaac ROS â†’ Nav2)
- Launch all components simultaneously with master launch file
- Run autonomous warehouse navigation demo
- Monitor system performance (CPU, GPU, network bandwidth)
- Handle edge cases (VSLAM tracking loss, Nav2 recovery, system failures)
- Extend the system with advanced features (better SLAM, custom planners)

## Introduction: The Complete AI Brain

In Chapters 1-3, we built three independent systems:
1. **Isaac Sim**: Photorealistic simulation + synthetic sensor data
2. **Isaac ROS VSLAM**: GPU-accelerated perception + 3D mapping
3. **Nav2**: Path planning + reactive navigation

**This chapter integrates them into a complete autonomous navigation stack**â€”the "AI brain" that enables humanoid robots to navigate unknown environments.

### System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ROS 2 Topics      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Isaac Sim  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  Isaac ROS VSLAM  â”‚
â”‚  (Sensors)  â”‚  /camera/*/image_raw   â”‚   (Perception)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  /scan, /tf            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â”‚ /visual_slam/tracking/odometry
                                                â”‚ /visual_slam/vis/map_points
                                                â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚       Nav2        â”‚
                                        â”‚    (Planning)     â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â”‚ /cmd_vel (velocity commands)
                                                â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   Robot Control   â”‚
                                        â”‚  (Isaac Sim ack)  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data Flow**:
1. Isaac Sim publishes sensor data (30 Hz)
2. Isaac ROS processes images â†’ generates map + pose (25 Hz)
3. Nav2 receives pose + map â†’ plans path â†’ sends velocity commands (20 Hz)
4. Isaac Sim receives velocity commands â†’ moves robot

---

## Section 1: Integration Architecture

### Frame Transform Tree

```
map (global frame, VSLAM origin)
 â””â”€ odom (odometry frame, VSLAM drift-corrected)
     â””â”€ base_link (robot base)
         â”œâ”€ head_link
         â”‚   â”œâ”€ camera_left_optical_frame
         â”‚   â””â”€ camera_right_optical_frame
         â””â”€ lidar_link
```

**Critical**: All nodes must agree on frame names. Mismatches cause TF lookup errors.

### Topic Connections

| Component | Subscribes | Publishes |
|-----------|-----------|-----------|
| Isaac Sim | /cmd_vel | /camera/*/image_raw, /scan, /tf |
| Isaac ROS VSLAM | /camera/*/image_raw, /camera/*/camera_info | /visual_slam/tracking/odometry, /visual_slam/vis/map_points, /tf (mapâ†’odom) |
| Nav2 | /scan, /visual_slam/tracking/odometry | /cmd_vel, /plan, /local_costmap/costmap |

### Timing Considerations

- **Sensor publishing (Isaac Sim)**: 30 Hz
- **VSLAM processing (Isaac ROS)**: 20-30 Hz (GPU-dependent)
- **Nav2 control loop**: 20 Hz (default)

**Synchronization**: Use `use_sim_time: True` to sync all nodes to Isaac Sim's simulation clock.

---

## Section 2: Master Launch File

Create unified launch file to start all components:

```python title="/static/code-examples/module-3/isaac_nav_full.launch.py"
#!/usr/bin/env python3
"""
Master Launch File: Complete Autonomous Navigation Stack
Isaac Sim + Isaac ROS VSLAM + Nav2
Module 3, Chapter 4
"""

from launch import LaunchDescription
from launch.actions import IncludeLaunchDescription, ExecuteProcess, TimerAction
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch_ros.actions import Node
import os

def generate_launch_description():
    code_examples_dir = os.path.dirname(__file__)

    # 1. Isaac ROS VSLAM (in Docker)
    vslam_launch = IncludeLaunchDescription(
        PythonLaunchDescriptionSource(
            os.path.join(code_examples_dir, 'isaac_ros_vslam_launch.py')
        )
    )

    # 2. Nav2 Stack (wait 10s for VSLAM to initialize)
    nav2_launch = TimerAction(
        period=10.0,
        actions=[IncludeLaunchDescription(
            PythonLaunchDescriptionSource(
                os.path.join(code_examples_dir, 'nav2_bipedal_bringup.launch.py')
            )
        )]
    )

    # 3. RViz2 with full visualization
    rviz_node = Node(
        package='rviz2',
        executable='rviz2',
        name='rviz2',
        arguments=['-d', os.path.join(code_examples_dir, 'full_navigation.rviz')]
    )

    return LaunchDescription([
        vslam_launch,
        nav2_launch,
        rviz_node,
    ])
```

---

## Section 3: Launching the Full Stack

### Prerequisites Checklist

- [ ] Isaac Sim installed and launched
- [ ] Humanoid robot with sensors loaded (Chapter 1)
- [ ] ROS 2 Bridge enabled in Isaac Sim
- [ ] Docker container running (Isaac ROS)
- [ ] Warehouse scene created in Isaac Sim

### Launch Sequence

**Step 1: Start Isaac Sim** (GUI)
1. Open Isaac Sim
2. Load warehouse scene: `/static/code-examples/module-3/scenes/humanoid_warehouse.usd`
3. Enable ROS 2 Bridge extension
4. Configure OmniGraph for sensor publishing (as in Chapter 1)
5. Press **Play** (but keep robot stationary initially)

**Step 2: Launch Full Stack** (Terminal)
```bash
cd /static/code-examples/module-3
docker exec -it isaac_ros_vslam bash
source /opt/ros/humble/setup.bash
ros2 launch isaac_nav_full.launch.py
```

**Expected output**:
```
[isaac_ros_visual_slam]: Initialized, waiting for images...
[nav2_planner_server]: Planner server is ready
[nav2_controller_server]: Controller server is ready
[rviz2]: RViz2 started with full_navigation.rviz
```

**Step 3: Verify System Status**

```bash
# Check all nodes running
ros2 node list | grep -E "(visual_slam|planner|controller)"

# Check TF tree complete
ros2 run tf2_tools view_frames.py
# Should show: map â†’ odom â†’ base_link â†’ camera_left/right, lidar

# Check topic rates
ros2 topic hz /camera/left/image_raw  # Should be ~30 Hz
ros2 topic hz /visual_slam/tracking/odometry  # Should be ~25 Hz
ros2 topic hz /cmd_vel  # Should be ~20 Hz (when navigating)
```

---

## Section 4: Autonomous Navigation Demo

### Demo Scenario: Warehouse Exploration

**Goal**: Navigate through warehouse, avoiding shelves, reach goal 20m away.

**Step 1: Set Initial Pose** (Optional, if VSLAM needs hint)
- In RViz2, click **"2D Pose Estimate"**
- Click robot's current position on map
- Drag to set orientation

**Step 2: Send Navigation Goal**
- Click **"2D Goal Pose"** in RViz2
- Click target location (e.g., 20m away, near exit)
- Drag to set goal orientation

**Step 3: Observe Autonomous Navigation**
- Robot builds map in real-time (green point cloud grows)
- Global path appears (green line through free space)
- Local path adjusts to avoid dynamic obstacles (yellow line)
- Robot follows path smoothly (velocity ~0.4 m/s)

**Step 4: Monitor in RViz2**
Watch these displays:
- **Map Points (PointCloud2)**: VSLAM map grows as robot explores
- **Global Costmap**: Static obstacles from map
- **Local Costmap**: Dynamic obstacles (rolling window)
- **Robot Trajectory**: Green breadcrumb trail showing path taken

### Automated Demo Script

```bash title="/static/code-examples/module-3/launch_full_demo.sh"
#!/bin/bash
# Automated full navigation demo
set -e

echo "ğŸš€ Starting Full Navigation Demo..."

# 1. Verify Isaac Sim is running
if ! ros2 topic list | grep -q "/camera/left/image_raw"; then
    echo "âŒ Isaac Sim not detected. Start Isaac Sim first!"
    exit 1
fi

# 2. Launch Docker container
echo "ğŸ“¦ Starting Isaac ROS container..."
cd docker
docker-compose up -d
sleep 3

# 3. Launch full stack
echo "ğŸ§  Launching perception + navigation stack..."
docker exec -d isaac_ros_vslam bash -c \
  "source /opt/ros/humble/setup.bash && \
   ros2 launch /code-examples/isaac_nav_full.launch.py"

sleep 15  # Wait for initialization

# 4. Send navigation goal programmatically
echo "ğŸ¯ Sending navigation goal: (x=15, y=5, yaw=0)"
python3 send_nav_goal.py 15.0 5.0 0.0

echo "âœ… Demo launched! Monitor in RViz2"
```

---

## Section 5: Monitoring System Performance

### CPU & GPU Usage

```bash
# Monitor GPU (Isaac ROS VSLAM)
watch -n 1 nvidia-smi
# Target: 40-60% GPU utilization, &lt;6GB VRAM

# Monitor CPU (Nav2)
htop
# Target: 50-70% total CPU (distributed across cores)
```

### Network Bandwidth (ROS 2 Topics)

```bash
# Check topic bandwidth
ros2 topic bw /camera/left/image_raw
# Expected: ~30 MB/s (1280x720 RGB @ 30Hz)

ros2 topic bw /scan
# Expected: ~500 KB/s (LiDAR point cloud)
```

### System Health Dashboard

```bash
# Install diagnostic tools
sudo apt install ros-humble-diagnostic-updater

# View diagnostics
ros2 run rqt_runtime_monitor rqt_runtime_monitor
```

### Performance Metrics

| Metric | Target | Typical (RTX 3060) |
|--------|--------|-------------------|
| VSLAM FPS | &gt;20 | 25-30 |
| Nav2 Control Rate | 20 Hz | 20 Hz |
| End-to-end Latency | &lt;200ms | 150ms |
| GPU Utilization | 40-60% | 50% |
| VRAM Usage | &lt;6GB | 4-5GB |

---

## Section 6: Handling Edge Cases

### Case 1: VSLAM Tracking Loss

**Symptom**: `/visual_slam/status` shows `LOST`, no odometry published.

**Recovery**:
1. **Stop robot**: Nav2 will auto-pause
2. **Add texture**: Place textured object in view
3. **Reset VSLAM**: Restart VSLAM node
4. **Relocalize**: Set initial pose in RViz2

### Case 2: Nav2 Gets Stuck

**Symptom**: Robot oscillates, `/cmd_vel` shows alternating forward/backward.

**Recovery (Automatic)**:
- Nav2 behavior tree triggers **recovery behaviors**:
  1. **Rotate Recovery**: Spin 360Â° to search for free space
  2. **Back Up Recovery**: Reverse 0.5m
  3. **Wait Recovery**: Pause 5s for dynamic obstacle to move

**Manual Override**:
```bash
# Cancel current goal
ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose "{}" --feedback
# Press Ctrl+C to cancel

# Send new goal
python3 send_nav_goal.py <new_x> <new_y> <new_yaw>
```

### Case 3: System Overload (Low FPS)

**Symptom**: VSLAM drops to 10 FPS, navigation stutters.

**Solutions**:
1. **Reduce image resolution** in Isaac Sim: 640Ã—480 instead of 1280Ã—720
2. **Close other applications** using GPU
3. **Disable RViz2 camera view** (most GPU-intensive)
4. **Lower Nav2 control rate**:
   ```yaml
   controller_frequency: 10.0  # Down from 20 Hz
   ```

---

## Section 7: Extending the System

### Advanced Feature 1: Multi-Goal Waypoint Following

Patrol 5 waypoints in sequence:

```python
waypoints = [
    (5.0, 0.0, 0.0),
    (10.0, 5.0, 1.57),
    (5.0, 10.0, 3.14),
    (0.0, 5.0, -1.57),
    (0.0, 0.0, 0.0),
]

for (x, y, yaw) in waypoints:
    send_goal(x, y, yaw)
    wait_for_completion()
```

### Advanced Feature 2: Custom Nav2 Plugin (Example)

Create custom local planner with humanoid-specific constraints:

```cpp
// Custom DWB critic for bipedal stability
class StabilityCritic : public dwb_core::TrajectoryCritic {
  double scoreTrajectory(const dwb_msgs::msg::Trajectory2D& traj) override {
    // Penalize trajectories with high angular velocity (balance risk)
    double angular_penalty = std::abs(traj.velocity.theta) * 2.0;
    return angular_penalty;
  }
};
```

### Advanced Feature 3: Learned SLAM (Replace VSLAM)

Use DeepSLAM or NeRF-SLAM for challenging environments:
- Low-texture scenes (blank walls)
- High-speed motion (running)
- Outdoor (changing lighting)

---

## Exercises

### Exercise 1: Test in Complex Environment
Create cluttered warehouse with 50+ obstacles, verify successful navigation.

### Exercise 2: Dynamic Obstacle Avoidance
Have another robot move through path, observe Nav2 replanning in real-time.

### Exercise 3: Compare with Baseline
Run same scenario with CPU-only VSLAM, compare FPS and accuracy.

### Exercise 4: Failure Mode Analysis
Intentionally trigger failures (cover cameras, block path), observe recovery behaviors.

---

## Troubleshooting

### Issue: TF Lookup Timeout

**Solution**: Check all TF publishers are running. Verify frame names match exactly.

### Issue: Navigation Completes but Robot Overshot Goal

**Solution**: Tighten goal tolerances:
```yaml
xy_goal_tolerance: 0.1  # meters
yaw_goal_tolerance: 0.1  # radians
```

### Issue: High Latency (>500ms end-to-end)

**Solution**: Use CycloneDDS (faster than FastDDS for local communication):
```bash
export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
```

---

## Module Summary

Congratulations! You've completed Module 3: The AI-Robot Brain (NVIDIA Isaac).

### What You Built

âœ… **Chapter 1**: Synthetic sensor data generation in Isaac Sim (6,400 words, 3 scripts)
âœ… **Chapter 2**: GPU-accelerated VSLAM with Isaac ROS (6,800 words, 4 scripts)
âœ… **Chapter 3**: Bipedal path planning with Nav2 (5,200 words, 4 scripts)
âœ… **Chapter 4**: Full autonomous navigation integration (4,800 words, 2 scripts)

**Total**: 23,200 words, 13 Python scripts, 4 launch files, 3 Isaac Sim scenes

### Key Takeaways

1. **Perception**: GPU acceleration enables real-time VSLAM (25 FPS) for fast robots
2. **Planning**: Nav2's modular architecture adapts to bipedal motion constraints
3. **Integration**: ROS 2's pub/sub model cleanly separates perception/planning/control
4. **Simulation**: Isaac Sim provides unlimited synthetic data for algorithm development

### What's Next?

**Module 4** (if available): Advanced topics like manipulation, VLA models, or multi-robot systems.

**Projects to Try**:
- Deploy on physical humanoid hardware (Jetson AGX Orin)
- Add semantic segmentation for object-aware navigation
- Implement learned locomotion policies (RL in Isaac Sim)
- Build multi-floor navigation with elevators

---

## Additional Resources

- **NVIDIA Isaac Platform**: [https://developer.nvidia.com/isaac](https://developer.nvidia.com/isaac)
- **Isaac ROS GitHub**: [https://github.com/NVIDIA-ISAAC-ROS](https://github.com/NVIDIA-ISAAC-ROS)
- **Nav2 GitHub**: [https://github.com/ros-planning/navigation2](https://github.com/ros-planning/navigation2)
- **ROS 2 Humble Docs**: [https://docs.ros.org/en/humble/](https://docs.ros.org/en/humble/)
- **Humanoid Robotics Papers**: [https://arxiv.org/list/cs.RO/recent](https://arxiv.org/list/cs.RO/recent)

---

## Acknowledgments

This module was built using:
- NVIDIA Isaac Sim, Isaac ROS, and cuVSLAM
- ROS 2 Humble and Nav2 navigation stack
- Docusaurus for documentation platform
- Open-source robotics community contributions

Thank you for completing Module 3! ğŸ‰
